<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= bundles[0].name %> - Source Map Explorer</title>

  <style>
    html, body { height: 100% }

    body {
      font-family: sans-serif;
      font-size: 0.8em;
      margin: 0;
      display: flex;
    }

    select, .webtreemap-caption { font-family: sans-serif }

    #content {
      display: flex;
      width: 100%;
      flex-direction: column;
      padding: 15px;
    }

    #header {
      display: flex;
      padding: 0 0 15px 15px;
      align-items: center;
    }

    #map {
      flex-grow: 1;
      position: relative;
      cursor: pointer;
      -webkit-user-select: none;
    }

    .webtreemap-caption {
      font-size: 11px !important;
      /* Align verically */
      padding-top: 4px;
    }

    .webtreemap-node:hover {
      background: #ededed !important;
    }

    .webtreemap-node {
      /* Level 0 */
      border-color: #444 !important; 
    }

    .webtreemap-node > .webtreemap-node {
      /* Level 1 */
      border-color: #666 !important;
    }

    .webtreemap-node > .webtreemap-node > .webtreemap-node {
      /* Level 2 */
      border-color: #888 !important;
    }

    .webtreemap-node > .webtreemap-node > .webtreemap-node > .webtreemap-node {
      /* Level 3 */
      border-color: #aaa !important;
    }

    .webtreemap-node > .webtreemap-node > .webtreemap-node > .webtreemap-node > .webtreemap-node {
      /* Level 4+ */
      border-color: #ccc !important;
    }
  </style>
</head>
<body>
  <div id="content">
    <% if(bundles.length > 1) {%>
    <div id="header">
      <label for="bundle-select">Bundle:&nbsp;</label>
      <select id="bundle-select">
      <%_ bundles.forEach((bundle) => { _%>
        <option value="<%= bundle.name %>"><%= bundle.name %> (<%= bundle.size %>)</option>
      <%_ }); _%>
      </select>
    </div>
    <% } %>
    <div id="map"></div>
  </div>
</body>

<script>
var webTreeDataMap = <%- JSON.stringify(webTreeDataMap) %>;
</script>

<script><%- webTreeMapJs %></script>

<script>
  var container = document.getElementById('map');
  var selectedBundle = '<%- bundles[0].name %>';

  var webTreeMapOptions = {
    padding: [20, 5, 5, 5],
    showChildren: () => true,
    showNode: () => true
  };

  function selectBundle(bundleId) {
    while (container.firstChild) {
      container.removeChild(container.firstChild);
    }

    webtreemap.render(container, webTreeDataMap[bundleId], webTreeMapOptions);

    document.title = bundleId + ' - Source Map Explorer';
  }

  <%_ if(bundles.length > 1) { _%>
  var bundleSelect = document.getElementById('bundle-select');
  bundleSelect.addEventListener('change', function(event) {
    selectedBundle = bundleSelect.value;
    selectBundle(selectedBundle);
  })
  <%_ } _%>

  window.addEventListener('resize', function() {
    selectBundle(selectedBundle);
  });

  selectBundle(selectedBundle);
</script>
<html>
